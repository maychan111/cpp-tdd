# Build System

```
All output files are generated to the top-level `bin` directory.
```

## Windows
Use [apps.sln](../apps.sln) with Visual Studio 2015 to build everything. 

Keeping the apps.sln up-to-date will help developers who prefer to develop on Windows.  The only maintenance is to add the relevant source and header files to the various projects.

## Linux
On Linux, the `make` command can be used to build all the libraries and executables.  A combination of hand written and automatically generated makefiles are structured so that there should be minimal effort to maintaining the makefiles.

A separated [build.sh](../build.sh) script is used to invoke `make` and create installation packages.

### Common file: build/standard.mk
The `standard.mk` file is included by individual `makefile` in each project directories.  It contains the standard targets needed by the top level makefile, such as `debug`, `release` and `clean`.

### Common file: build/target.mk
This file contains the common macros used by all projects, such as GCC compiler flags, linker flags and standard include directories, as well as standard rules to make a C++ static library or executable.

This makefile includes project specific files: project.mk, objects.mk and exclude.mk, which contains project specific information.

### Common file: build/mmake
The `build/mmake` generates an `objects.mk` file in every directory that has a `project.mk` file. `objects.mk` will include all the .cpp files in that directory and its subdirectory, excluding files listed in `exclude.mk`.  This `objects.mk` file will be included in the common `target.mk` for dependency information. 

`mmake` is invoked auatomically by `build/standard.mk`.

### Project specific file: project.mk
There should be a project.mk for each library or executable project.

For a library project, project.mk should only need to contain the `TARGET` and `PROJECTDIR` macro:

+ `TARGET` defines the library name, example, libxxx.a
+ `PROJECTDIR` defines the subdirectory for the object files, e.g. `PROJECTDIR=xxx` will put all the .o and .d files in `bin/Release/xxx` or `bin/Debug/xxx`.  Each project should have a use a different project directory so that if we can have the same source file names in different projects.

For an executable file, the project.mk should define the following, in addition to the above macros:

+ `BUILDLIBS`: libraries (without `lib` prefix and `.a` suffix) this executable should link with
+ `LIBDEP`: directories to the `project.mk` for all the libraries listed in `BUILDLIBS`.
+ `LIBS`: actual link command to gcc.  For example, to link with all the libraries specified in `BUILDLIBS`, `LIBS` can be defined as `LIBS=$(foreach L,$(BUILDLIBS),-l$L)`

### Project specific file: objects.mk
This file is automatically generated by `build/mmake`.  Do not modify this file maunally.

### Project specific file: exclude.mk
This optional file contains .cpp files that you would like to exclude from this project.   One usage is that a source file may only apply to Windows and not the Linux build, and you wish to exclude this file from the build.